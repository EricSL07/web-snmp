version: "3.9"

services:
  postgres:
    image: postgres:16
    container_name: postgres
    restart: always
    environment:
      POSTGRES_USER: app
      POSTGRES_PASSWORD: apppass
      POSTGRES_DB: appdb
    ports:
      - "5432:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data

  ansible-api:
    build: ../ansible-api
    container_name: ansible-api
    environment:
      ANSIBLE_INVENTORY: /ansible/inventories/dev/hosts.ini
    volumes:
      - ../ansible:/ansible
    ports:
      - "5000:5000"

  mock-switch:
    image: lscr.io/linuxserver/openssh-server:latest
    container_name: mock-switch
    environment:
      PASSWORD_ACCESS: "true"
      USER_NAME: "admin"
      USER_PASSWORD: "admin123"
      SUDO_ACCESS: "false"
    ports:
      - "2222:2222"

  zabbix-postgres:
    image: postgres:15
    container_name: zabbix-postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: zabbix
      POSTGRES_PASSWORD: zabbix
      POSTGRES_DB: zabbix
    volumes:
      - zabbix-db:/var/lib/postgresql/data

  zabbix-server:
    image: zabbix/zabbix-server-pgsql:alpine-latest
    container_name: zabbix-server
    restart: unless-stopped
    environment:
      DB_SERVER_HOST: zabbix-postgres   # ðŸ‘ˆ apontando pro serviÃ§o correto
      POSTGRES_USER: zabbix
      POSTGRES_PASSWORD: zabbix
    depends_on:
      - zabbix-postgres
    ports:
      - "10051:10051"

  zabbix-web:
    image: zabbix/zabbix-web-nginx-pgsql:alpine-latest
    container_name: zabbix-web
    restart: unless-stopped
    environment:
      DB_SERVER_HOST: zabbix-postgres   # ðŸ‘ˆ idem
      POSTGRES_USER: zabbix
      POSTGRES_PASSWORD: zabbix
      ZBX_SERVER_HOST: zabbix-server
      PHP_TZ: America/Sao_Paulo
    depends_on:
      - zabbix-postgres
      - zabbix-server
    ports:
      - "8080:8080"

volumes:
  pgdata:
  zabbix-db:
